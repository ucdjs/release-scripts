flowchart TD
    Start([calculateBumps]) --> LoopPackages[For each package]
    
    LoopPackages --> MergeCommits[Merge commits + globalCommits]
    
    MergeCommits --> DetermineBump[determineBump(commits)]
    
    subgraph BumpLogic["determineBump Logic"]
        direction TB
        
        BLStart[Start with 'none'] --> LoopCommits[For each commit]
        
        LoopCommits --> CheckBreaking{isBreaking?}
        CheckBreaking -->|Yes| SetMajor[Set 'major']
        CheckBreaking -->|No| CheckFeat{type === 'feat'?}
        
        CheckFeat -->|Yes| CheckCurrent{Current bump < 'minor'?}
        CheckFeat -->|No| CheckFix{type === 'fix'<br/>|| 'perf'?}
        
        CheckCurrent -->|Yes| SetMinor[Set 'minor']
        CheckCurrent -->|No| Keep[Keep current]
        
        CheckFix -->|Yes| CheckPatch{Current bump < 'patch'?}
        CheckFix -->|No| NextCommit
        
        CheckPatch -->|Yes| SetPatch[Set 'patch']
        CheckPatch -->|No| Keep
        
        SetMajor --> Done[Return 'major']
        SetMinor --> LoopMore{More commits?}
        SetPatch --> LoopMore
        Keep --> LoopMore
        NextCommit --> LoopMore
        
        LoopMore -->|Yes| LoopCommits
        LoopMore -->|No| ReturnBump[Return accumulated bump]
    end
    
    DetermineBump --> CheckOverride{Override exists<br/>for package?}
    
    CheckOverride -->|Yes| ValidateOverride[semver.valid?]
    ValidateOverride -->|No| ThrowError[Throw VersionCalculationError]
    ValidateOverride -->|Yes| UseOverride[Use override version]
    
    CheckOverride -->|No| CalcVersion{Calculate version}
    
    CalcVersion -->|bump === 'none'| KeepVersion[Keep current version]
    CalcVersion -->|bump !== 'none'| IncVersion[semver.inc(version, bump)]
    
    UseOverride --> BuildRelease
    KeepVersion --> BuildRelease
    IncVersion --> BuildRelease[Build PackageRelease object]
    
    BuildRelease --> MorePackages{More packages?}
    MorePackages -->|Yes| LoopPackages
    MorePackages -->|No| ReturnReleases[Return PackageRelease[]]
    
    ThrowError --> End([End])
    ReturnReleases --> End
    
    style Start fill:#e1f5e1
    style End fill:#e1f5e1
    style BumpLogic fill:#fff4e1
    style ThrowError fill:#ffe1e1
