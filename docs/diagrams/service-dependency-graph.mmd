classDiagram
    class ReleaseScriptsOptions {
        +string repo
        +string githubToken
        +string workspaceRoot
        +PackagesConfig packages
        +BranchConfig branch
        +GlobalCommitMode globalCommitMode
        +boolean dryRun
    }

    class ReleaseScriptsAPI {
        +verify() Promise~void~
        +prepare() Promise~void~
        +publish() Promise~void~
        +packages.list() Promise~Package[]~
        +packages.get(name) Promise~Package~
    }

    class GitService {
        <<Effect Service>>
        +create(branch) Effect~void~
        +checkout(branch) Effect~void~
        +getCommitsSince(ref) Effect~Commit[]~
        +getMostRecentPackageTag(pkg) Effect~string~
        +readFile(path, ref) Effect~string~
        +stage(files) Effect~void~
        +write(message) Effect~void~
        +push(branch) Effect~void~
    }

    class GitHubService {
        <<Effect Service>>
        +getPullRequestByBranch(branch) Effect~PR | null~
        +createPullRequest(data) Effect~PR~
        +updatePullRequest(number, data) Effect~PR~
        +setCommitStatus(sha, state, description) Effect~void~
    }

    class WorkspaceService {
        <<Effect Service>>
        +discoverPackages() Effect~Package[]~
        +readPackageJson(path) Effect~PackageJson~
        +writePackageJson(path, data) Effect~void~
        +getWorkspaceDependencies(pkg) Effect~string[]~
    }

    class VersionCalculatorService {
        <<Effect Service>>
        +calculateBump(commits) Effect~BumpType~
        +applyBump(version, bump) Effect~string~
        +calculateVersions(packages) Effect~Map~
    }

    class DependencyGraphService {
        <<Effect Service>>
        +buildGraph(packages) Effect~Graph~
        +topologicalSort(graph) Effect~Package[]~
        +detectCycles(graph) Effect~void~
        +assignLevels(sorted) Effect~Package[]~
    }

    class PackageUpdaterService {
        <<Effect Service>>
        +applyRelease(pkg, version, all) Effect~void~
        +updateDependencies(pkg, all) Effect~PackageJson~
        +validateRanges(pkg) Effect~void~
    }

    class NPMService {
        <<Effect Service>>
        +getPackument(name) Effect~Packument~
        +versionExists(name, version) Effect~boolean~
        +getLatestVersion(name) Effect~string~
    }

    class ChangelogService {
        <<Effect Service>>
        +generateChangelog(pkg, version, commits) Effect~ChangelogResult~
    }

    class ChangelogFormatters {
        <<Utils Module>>
        +parseCommits(commits) ChangelogEntry[]
        +groupByType(entries) Map
        +createChangelog(data) PackageChangelog
        +formatChangelogMarkdown(changelog) string
    }

    class HelperUtilities {
        <<Static Functions>>
        +loadOverrides() Effect~Overrides~
        +mergePackageCommitsIntoPackages() Effect~Package[]~
        +mergeCommitsAffectingGloballyIntoPackage() Effect~Package[]~
        +isGlobalCommit(commit, packages) boolean
        +isDependencyFile(path) boolean
        +findCommitRange(packages) CommitRange
    }

    %% Configuration flows into services
    ReleaseScriptsOptions ..> GitService : configures
    ReleaseScriptsOptions ..> GitHubService : configures
    ReleaseScriptsOptions ..> WorkspaceService : configures

    %% Service dependencies
    WorkspaceService --> GitService : uses for file ops
    VersionCalculatorService --> WorkspaceService : reads packages
    DependencyGraphService --> WorkspaceService : analyzes packages
    PackageUpdaterService --> WorkspaceService : updates packages
    PackageUpdaterService --> VersionCalculatorService : applies versions
    PackageUpdaterService --> DependencyGraphService : uses topo order

    %% Changelog service dependencies
    ChangelogService --> ChangelogFormatters : uses pure functions
    ChangelogFormatters --> HelperUtilities : uses GitCommit type

    %% Helper utilities
    HelperUtilities --> GitService : reads overrides
    HelperUtilities --> WorkspaceService : enriches packages
    VersionCalculatorService --> HelperUtilities : uses for commits

    %% API uses services
    ReleaseScriptsAPI --> GitService : git operations
    ReleaseScriptsAPI --> GitHubService : PR & status
    ReleaseScriptsAPI --> WorkspaceService : package discovery
    ReleaseScriptsAPI --> VersionCalculatorService : version bumps
    ReleaseScriptsAPI --> DependencyGraphService : dependency ordering
    ReleaseScriptsAPI --> PackageUpdaterService : apply updates
    ReleaseScriptsAPI --> ChangelogService : generate changelogs
    ReleaseScriptsAPI --> NPMService : check/publish
    ReleaseScriptsAPI --> HelperUtilities : helper functions

    %% Styling
    style GitService fill:#ffe1e1
    style GitHubService fill:#ffe1e1
    style NPMService fill:#ffe1e1
    style WorkspaceService fill:#e1ffe1
    style VersionCalculatorService fill:#fff4e1
    style DependencyGraphService fill:#fff4e1
    style PackageUpdaterService fill:#f0e1ff
    style ChangelogService fill:#fffacd
    style ChangelogFormatters fill:#90ee90
    style HelperUtilities fill:#f0f0f0
    style ReleaseScriptsOptions fill:#e1f0ff
    style ReleaseScriptsAPI fill:#d4edda
